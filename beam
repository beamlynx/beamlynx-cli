#!/usr/bin/env bash
set -e
export WORKDIR=$(cd "$(dirname "$(realpath "$0")")" && pwd)
. "$WORKDIR/common"

cli_help() {
  cli_name=${0##*/}
  echo -e "
\033[90m
  $cli_name
  Beamlynx Command Line Interface
  Version: $(cat $WORKDIR/VERSION)
  https://github.com/beamlynx/beamlynx-cli
`cat $WORKDIR/art/logo.txt`

Usage: $cli_name [command]

Commands:
  api           Run the pine-lang server
  ui            Run beamlynx
  config        Configure the beamlynx CLI
  *             Help

\033[0m
"
  exit 0
}

# cli_log "Reading configuration"
[ ! -f "$CONFIG_DIR/config" ] \
  && echo "ERROR: No $CONFIG_DIR/config file found. " \
  && echo "Run install script." \
  && exit 1

export $(cat "$CONFIG_FILE" | xargs)

main () {
    case "$1" in
        ui)
            "$WORKDIR/commands/ui" | tee -ia "$WORKDIR/logs/ui.log"
            ;;
        api)
            "$WORKDIR/commands/api" $3 | tee -ia "$WORKDIR/logs/api.log"
            ;;

        config)
            "$WORKDIR/commands/config"
            ;;
        *)
            cli_help
            ;;
    esac

}

main "$@"
